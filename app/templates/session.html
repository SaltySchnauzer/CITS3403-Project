{% extends "base.html" %}
{% set bodycss = 'bg-green-100' %}

{% block content %}
{% if sessionID is defined %}
<script>
  const oldSession = {{sessionID}};
</script>
{% endif %}

<div id="session-wrapper" class="transition-opacity duration-700 bg-green-100 py-12 px-6 md:px-20 lg:px-40">
  <div class="max-w-4xl mx-auto text-center space-y-8">

    <div class="text-3xl md:text-4xl font-extrabold text-gray-900">
      Start a Focus Session
    </div>

    <div class="text-2xl font-mono text-gray-800">
      Elapsed: <span id="timer">00:00</span>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="mx-auto w-fit px-4 py-2 rounded-md text-center text-white font-medium
                      {% if category == 'danger' %} bg-red-500
                      {% elif category == 'success' %} bg-green-500
                      {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Start/End Buttons -->
    <div class="flex justify-center space-x-6 mt-4">
      <button id="start-session"
              class="px-6 py-3 rounded-full bg-gradient-to-r from-cyan-500 to-cyan-600 text-white font-semibold shadow-lg transform transition 
                     border border-cyan-300 hover:scale-105 hover:shadow-xl hover:brightness-110 active:translate-y-0.5 
                     disabled:opacity-50 disabled:cursor-not-allowed">
        Start Session
      </button>

      <button id="end-session"
              class="px-6 py-3 rounded-full bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-lg transform transition 
                     border border-red-300 hover:scale-105 hover:shadow-xl hover:brightness-110 active:translate-y-0.5 
                     disabled:opacity-50 disabled:cursor-not-allowed"
              disabled>
        End Session
      </button>
    </div>
  </div>

  <!-- Recent Sessions -->
  <div id="previous-sessions" class="max-w-5xl mx-auto mt-16">
    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6 text-center">
      Recent Sessions
    </h2>

    {% if current_user.sessions %}
      <div class="grid gap-6 sm:grid-cols-1 md:grid-cols-2">
        {% for s in recent_sessions %}
          <div class="bg-white rounded-2xl border border-gray-200 shadow-md p-6 transform transition duration-300 hover:scale-105 hover:shadow-xl hover:text-gray-800">
            <div class="text-xl font-semibold text-gray-800">
              {{ s.name or "Session" }}
            </div>
            <div class="text-sm text-gray-500 mt-1">
              <span class="session-time"
                    data-start="{{ s.started_at.isoformat() }}"
                    data-end="{{ s.ended_at.isoformat() }}">Loading...</span>
              : {{ (s.duration / 60) | round(0) | int }} mins
            </div>
            <div class="italic text-sm text-gray-600 mt-2">
              {% if s.description == '' %}
                No Description.
              {% else %}
                {{ s.description }}
              {% endif %}
            </div>
            <div class="text-sm text-gray-700 mt-2">
              Productivity: <span class="font-medium">{{ s.productivity | round | int }}%</span>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center text-gray-500 italic">No sessions yet.</div>
    {% endif %}
  </div>
</div>

<!-- Focus Mode Layout -->
<div id="focus-mode" class="hidden h-screen bg-green-50 flex flex-col md:flex-row items-center justify-center px-6 space-y-6 md:space-y-0 md:space-x-10">
  <div class="w-full md:w-1/2 text-center space-y-6">
    <div class="text-3xl font-mono text-gray-800">
      Elapsed: <span id="focus-timer">00:00</span>
    </div>
    <button id="focus-end"
            class="px-6 py-3 rounded-full bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold shadow-lg transform transition 
                   border border-red-300 hover:scale-105 hover:shadow-xl hover:brightness-110 active:translate-y-0.5">
      End Session
    </button>
  </div>
  <div class="w-full md:w-3/5 flex justify-center">
    <img src="{{ url_for('static', filename='study5.gif') }}"
         alt="Study Visual"
         class="max-h-[80vh] object-contain rounded-xl shadow-md">
  </div>
</div>

{% include 'session_form.html' %}
<script src="{{ url_for('static', filename='session.js') }}"></script>
{% endblock %}
